<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<link rel="alternate" type="application/rss+xml" href="/reskript/blog/rss.xml" title="reSKRipt Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/reskript/blog/atom.xml" title="reSKRipt Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="reSKRipt" href="/reskript/opensearch.xml"><title data-react-helmet="true">升级至V2 | reSKRipt</title><meta data-react-helmet="true" property="og:url" content="https://ecomfe.github.io/reskript/docs/migration/v2"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="升级至V2 | reSKRipt"><meta data-react-helmet="true" name="description" content="本文摘录了reSKRipt V2版本的所有破坏性变更，如果你正在使用1.x版本，可以参考本文进行升级。如果你在升级过程中遇到任何困难，欢迎在GitHub上提交Issue来咨询。"><meta data-react-helmet="true" property="og:description" content="本文摘录了reSKRipt V2版本的所有破坏性变更，如果你正在使用1.x版本，可以参考本文进行升级。如果你在升级过程中遇到任何困难，欢迎在GitHub上提交Issue来咨询。"><link data-react-helmet="true" rel="shortcut icon" href="/reskript/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://ecomfe.github.io/reskript/docs/migration/v2"><link data-react-helmet="true" rel="alternate" href="https://ecomfe.github.io/reskript/docs/migration/v2" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://ecomfe.github.io/reskript/docs/migration/v2" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/reskript/assets/css/styles.7a0f85c1.css">
<link rel="preload" href="/reskript/assets/js/runtime~main.212b4bf1.js" as="script">
<link rel="preload" href="/reskript/assets/js/main.a26f1fa1.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/reskript/"><img src="/reskript/images/logo.svg" alt="reSKRipt" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/reskript/images/logo.svg" alt="reSKRipt" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/reskript/docs/getting-started">文档</a><a class="navbar__item navbar__link" href="/reskript/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/ecomfe/reskript" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/reskript/docs/getting-started">开始使用</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">应用开发</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">配置</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">命令行</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">高阶应用</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">插件</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">版本升级手册</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/reskript/docs/migration/v2">升级至V2</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/reskript/docs/faq">FAQ</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1 class="h1Heading_27L5">升级至V2</h1></header><p>本文摘录了<code>reSKRipt V2</code>版本的所有破坏性变更，如果你正在使用<code>1.x</code>版本，可以参考本文进行升级。如果你在升级过程中遇到任何困难，欢迎<a href="https://github.com/ecomfe/reskript/issues/new" target="_blank" rel="noopener noreferrer">在GitHub上提交Issue</a>来咨询。</p><p>V2的主要更新为引入<code>webpack-dev-sever 4.x</code>版本，并以此为契机废弃部分不合理的接口，总体上调整有限。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="每一位都要了解的"></a>每一位都要了解的<a class="hash-link" href="#每一位都要了解的" title="Direct link to heading">#</a></h2><p>以下是V2版本中涉及到所有使用者的变化，无论你以什么样的形式使用<code>reSKRipt</code>，你都应该关心这些变更。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="nodejs版本"></a>NodeJS版本<a class="hash-link" href="#nodejs版本" title="Direct link to heading">#</a></h3><p>在V2中，NodeJS的最低版本要求升级为<code>14.14.0</code>，这是为了我们可以使用<code>fs.rm</code>函数更高效地进行目录、文件的清理。V1版本的NodeJS要求为<code>14.13.1</code>，所以你只要确保本地NodeJS版本符合要求，基本不需要关心由NodeJS带来的差异。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="推荐固定版本"></a>推荐固定版本<a class="hash-link" href="#推荐固定版本" title="Direct link to heading">#</a></h3><p>从V2版本开始，我们推荐你使用固定版本的方式安装<code>@reskript/*</code>包，如果你原本已经安装了相应的包，推荐你将版本范围前的<code>^</code>符号移除：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly diff"><pre tabindex="0" class="prism-code language-diff codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">&quot;devDependencies&quot;: {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">  &quot;@reskript/cli&quot;: &quot;^1.15.2&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">  &quot;@reskript/cli-babel&quot;: &quot;^1.15.2&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">  &quot;@reskript/cli-build&quot;: &quot;^1.15.2&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">  &quot;@reskript/cli-dev&quot;: &quot;^1.15.2&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">  &quot;@reskript/cli-lint&quot;: &quot;^1.15.2&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">  &quot;@reskript/cli-play&quot;: &quot;^1.15.2&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">  &quot;@reskript/cli-test&quot;: &quot;^1.15.2&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">  &quot;@reskript/cli&quot;: &quot;1.15.2&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">  &quot;@reskript/cli-babel&quot;: &quot;1.15.2&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">  &quot;@reskript/cli-build&quot;: &quot;1.15.2&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">  &quot;@reskript/cli-dev&quot;: &quot;1.15.2&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">  &quot;@reskript/cli-lint&quot;: &quot;1.15.2&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">  &quot;@reskript/cli-play&quot;: &quot;1.15.2&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">  &quot;@reskript/cli-test&quot;: &quot;1.15.2&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>在移除<code>^</code>符号后，记得再重新运行一次安装命令，即<code>npm install</code>、<code>yarn install</code>或<code>pnpm install</code>以更新版本锁文件。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="安装core-js"></a>安装core-js<a class="hash-link" href="#安装core-js" title="Direct link to heading">#</a></h3><p>在V1版本中，<code>reSKRipt</code>会自带<code>core-js</code>并为你处理好polyfill的引入路径，让你不需要感知到它的存在。但随着时间的推移，我们发现这样做并不是一个合理的方案，它存在着一些不可忽视的问题：</p><ol><li>由于需要正确处理<code>core-js</code>的路径，在构建过程中增加了大量额外的源码扫描和转义，使得构建的速度被拖慢不少。</li><li>在应用长期的维护过程中，因为<code>core-js</code>是一个间接的依赖，并不容易得到版本的更新。这致使应用的业务代码使用了新的特性时，由于<code>core-js</code>版本的落后无法补上相应的polyfill，让代码产生了问题。</li></ol><p>出于这些考虑，在V2版本中，我们转为要求用户自行安装<code>core-js</code>。你只需要在本地简单地增加这一依赖即可：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># npm</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">npm</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> -D core-js</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># yarn</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">yarn</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">add</span><span class="token plain"> -D core-js</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># pnpm</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">pnpm</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">add</span><span class="token plain"> -D core-js</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>如果你没有安装<code>core-js</code>，在执行<code>skr build</code>或<code>skr dev</code>时会报错退出，提示信息也会引导你正确地安装依赖。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="svg使用方式变化"></a>SVG使用方式变化<a class="hash-link" href="#svg使用方式变化" title="Direct link to heading">#</a></h3><p>请参考<a href="/reskript/blog/svg-import-change">导入SVG文件规则调整</a>中的说明，V2版本中，如果你需要引入一个<code>.svg</code>文件并作为React组件来使用，你需要相应调整你的代码：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly diff"><pre tabindex="0" class="prism-code language-diff codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"> import {ReactComponent as Icon} from &#x27;./icon.svg&#x27;;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"> import Icon from &#x27;./icon.svg?react&#x27;;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>如果你在CSS中引用<code>.svg</code>文件，且使用了<code>.svg?asset</code>这样的形式，那么可以删除其中的<code>?asset</code>部分：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly diff"><pre tabindex="0" class="prism-code language-diff codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"> background-url: url(&quot;./background.svg?asset&quot;);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"> background-url: url(&quot;./background.svg&quot;);</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="命令行变更"></a>命令行变更<a class="hash-link" href="#命令行变更" title="Direct link to heading">#</a></h2><p>如果你使用<code>skr build</code>、<code>skr dev</code>、<code>skr test</code>等命令，以下这些变更是你需要关注的。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="build"></a>build<a class="hash-link" href="#build" title="Direct link to heading">#</a></h3><p><code>--src</code>参数修改为<code>--src-dir</code>参数，功能保持不变。这常用于使用<code>skr build</code>构建demo等场景，你只需要参数名即可：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly diff"><pre tabindex="0" class="prism-code language-diff codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"> skr build --src=demo</span></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"> skr build --src-dir=demo</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="dev"></a>dev<a class="hash-link" href="#dev" title="Direct link to heading">#</a></h3><p><code>--src</code>参数修改为<code>--src-dir</code>参数。与<code>skr build</code>相同的调整，你只需要修改参数名：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly diff"><pre tabindex="0" class="prism-code language-diff codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"> skr dev --src=demo</span></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"> skr dev --src-dir=demo</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><code>--open</code>参数已经改为<code>--host</code>参数。原有的<code>--open</code>参数取值<code>local</code>和<code>remote</code>，用来指示<code>skr dev</code>调试时浏览器打开的地址是<code>localhost</code>还是本地的IP地址。</p><hr><p>新的<code>--host</code>参数拥有更强大的功能，支持<code>localhost</code>、<code>loopback</code>、<code>ip</code>和任意自定义的域名。如果你的应用需要与域名强绑定，并且你通过修改<code>hosts</code>把特定的域名解析到了<code>127.0.0.1</code>，那么可以通过<code>--host=my-app.dev</code>这样的形式进行调试。</p><p>如果你原先使用着<code>--open</code>参数，可以根据你的取值进行相应的修改：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly diff"><pre tabindex="0" class="prism-code language-diff codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"> skr dev --open=local</span></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"> skr dev --host=localhost</span></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"> skr dev --open=remote</span></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"> skr dev --host=ip</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="babel"></a>babel<a class="hash-link" href="#babel" title="Direct link to heading">#</a></h3><p><code>--out</code>参数修改为<code>--out-dir</code>参数。为了所有的命令有更一致地参数命名，与<code>--src-dir</code>相同，我们使用<code>--out-dir</code>来指定<code>skr babel</code>的输出目录。对于原先使用这一参数的情况，也可以通过简单地修改名称来升级：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly diff"><pre tabindex="0" class="prism-code language-diff codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"> skr babel --out=dist</span></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"> skr babel --out-dir-dist</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="test"></a>test<a class="hash-link" href="#test" title="Direct link to heading">#</a></h3><p><code>skr test</code>有比较大的调整。在V2的<code>skr test</code>中，我们支持了透传参数给<code>jest</code>，因此原有的除<code>--cwd</code>和<code>--target</code>以外的参数都已经废弃了。新版透传给<code>jest</code>的参数需要在命令行中跟随在一个<code>--</code>分隔符之后。</p><p>一般来说，你可以简单地在命令中增加<code>--</code>分隔来实现升级：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly diff"><pre tabindex="0" class="prism-code language-diff codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"> skr test --target=react --changedSince=HEAD --maxWorkers=4 src/utils</span></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"> skr test --target=react src/utils -- --changedSince=HEAD --maxWorkers=4</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>在调整过程中，你需要将原有测试的路径参数放到<code>--</code>前面，其它除<code>--cwd</code>和<code>--target</code>外的参数放到<code>--</code>的后面。</p><p>需要额外注意的是，原有的<code>--collect-coverage-from</code>参数与<code>jest</code>的参数不同，它需要被修改为<code>--collectCoverageFrom</code>：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly diff"><pre tabindex="0" class="prism-code language-diff codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"> skr test --target=react --collect-coverage-from=src/utils</span></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"> skr test --target=react -- --collectCoverageFrom=src/utils</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>另外，如果你是使用<code>npm run test</code>去执行命令，并依旧想在命令行中传递额外参数给<code>jest</code>的话，你需要<strong>2个</strong><code>--</code>分隔符：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly diff"><pre tabindex="0" class="prism-code language-diff codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"> npm run test -- --changedSince=HEAD</span></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"> npm run test -- -- --changedSince=HEAD</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="配置文件变更"></a>配置文件变更<a class="hash-link" href="#配置文件变更" title="Direct link to heading">#</a></h2><p>如果你除了使用命令行外，在项目中还有<code>reskript.config.js</code>用于配置，那么你可能需要关心不少的配置变更。当然大部分变更都是简单的调整，我们有信心你可以在很短的时间内调整完毕。</p><p>对于<code>reskript.config.js</code>，我们在执行命令时有严格的结构校验，因此你不需要担心遗漏了什么修改使得应用出现错误。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="build相关"></a>build相关<a class="hash-link" href="#build相关" title="Direct link to heading">#</a></h3><p><code>build.defaultImportOptimization</code>已经移除。如果你未曾见过这一个配置，那么你的应用不会有任何行为上的变化。</p><p><code>defaultImportOptimization</code>配置用于控制是否针对<code>antd</code>和<code>lodash</code>两个库的<code>import</code>语句进行优化。在新版本中，你可以使用<code>build.uses</code>参数控制更多的第三方库的优化，这个配置默认依然启用了对<code>antd</code>和<code>lodash</code>的优化。</p><p>如果你原先禁用了这个配置，那么在V2版本中，你需要将<code>uses</code>设置为空数组，以关闭默认优化逻辑：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly diff"><pre tabindex="0" class="prism-code language-diff codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">exports.build = {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">     defaultImportOptimization: false,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">     uses: [],</span></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">};</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>具体对<code>build.uses</code>的使用，可以参考<a href="/reskript/docs/settings/build#%E7%89%B9%E6%AE%8A%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E7%9A%84%E4%BC%98%E5%8C%96">构建配置 - 特殊第三方库的优化</a>来了解。</p><hr><p>如果你有使用形如<code>entries/index.config.js</code>的<a href="/reskript/docs/advanced/multiple-entry#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%85%A5%E5%8F%A3%E9%85%8D%E7%BD%AE">自定义入口配置</a>功能，且在<code>*.config.js</code>中导出<strong>任意的属性</strong>以供自定义的模板中使用的话，这一方法已经被废弃了。在V2版本中，你需要将自定义的属性收集到<code>exports.html</code>对象中：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly diff"><pre tabindex="0" class="prism-code language-diff codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"> exports.appVersion = &#x27;1.2.3&#x27;;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"> exports.copyrightYear = 2021;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"> exports.html = {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">     appVersion: &#x27;1.2.3&#x27;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">     copyrightYear: 2021,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"> };</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>除此之外，我们也支持在<code>*.config.js</code>中导出<code>exports.entry</code>配置入口的构建逻辑，具体可以参阅<a href="/reskript/docs/advanced/multiple-entry#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%85%A5%E5%8F%A3%E9%85%8D%E7%BD%AE">多应用入口 - 自定义入口配置</a>了解。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="devserver相关"></a>devServer相关<a class="hash-link" href="#devserver相关" title="Direct link to heading">#</a></h3><p>由于V2版本最大的更新在于<code>webpack-dev-server</code>升级到了<code>4.x</code>版本，<code>reskript.config.js</code>中的<code>exports.devServer</code>也产生了相应的变化。</p><p>首先<code>devServer.hot</code>的值从原有的<code>&#x27;simple&#x27; | &#x27;all&#x27; | &#x27;none&#x27;</code>改为了单纯的<code>boolean</code>类型，我们发现并没有场景只需要<code>simple</code>模式的热更新，同时由<code>react-refresh</code>驱动的组件热更新也已经非常成熟，因此简化了热更新的配置。</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly diff"><pre tabindex="0" class="prism-code language-diff codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">exports.devServer = {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">     hot: &#x27;all&#x27;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">     hot: true,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">};</span></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">// 如果需要关闭热更新</span></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">exports.devServer = {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">     hot: &#x27;none&#x27;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">     hot: false,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">};</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><hr><p><code>devServer.finalize</code>强依赖于<code>webpack-dev-server</code>的配置格式，因此如果你有使用这个配置，也需要进行相应的修改。具体的修改与官方的更新对应，你可以通过<a href="https://github.com/webpack/webpack-dev-server/blob/master/migration-v4.md" target="_blank" rel="noopener noreferrer">官方升级指南</a>来进行相应修改。</p><p>一般来说，你通过<code>devServer.finalize</code>调整的常用配置不受版本更新的影响，但有2个常见的案例可供参考。</p><p>如果你原本通过<code>watchOptions.ignored</code>配置调整本地监听的文件变更，可以做出相应的修改：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly diff"><pre tabindex="0" class="prism-code language-diff codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">export.devServer = {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    finalize: (devServerConfig) =&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">        devServerConfig.watchOptions.ignored = undefined;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">        devServerConfig.static.watch.ignored = undefined;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">        return devServerConfig;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    },</span></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">};</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>如果你使用<code>before</code>或<code>after</code>来挂载自己的路径，也需要根据官方的升级进行调整，此处以<code>before</code>为例：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly diff"><pre tabindex="0" class="prism-code language-diff codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">export.devServer = {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    finalize: (devServerConfig) =&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">        const {before} = devServerConfig;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">        const {onBeforeSetupMiddleware} = devServerConfig;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">        devServerConfig.before = (app, server, compiler) =&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">        devServerConfig.onBeforeSetupMiddleware = devServer =&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">            before?.(app, server, compiler);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">            onBeforeSetupMiddleware?.(devServer);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">            app.get(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">            devServer.app.get(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">                &#x27;/version&#x27;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">                (req, res) =&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">                    res.status(200).type(&#x27;html&#x27;).end(`${packageInfo.name}@${packageInfo.version}`);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">                },</span></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">            ),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">        };</span></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">        return devServerConfig;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    },</span></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">};</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="play相关"></a>play相关<a class="hash-link" href="#play相关" title="Direct link to heading">#</a></h3><p><code>play.wrapper</code>和<code>play.injectResources</code>配置现在都已经废弃了，取而代之的是全局的初始化模块<code>play.defaultGlobalSetup</code>配置。</p><p>通过<code>play.defaultGlobalSetup</code>你可以指定一个模块作为所有<code>skr play</code>命令的全局初始化，你可以参考<a href="/reskript/docs/settings/play#%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE">单组件调试配置 - 全局配置</a>来了解它的作用。</p><p>原有的<code>play.wrapper</code>可以使用全局配置中的<code>export function Wrapper</code>来代替：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly diff"><pre tabindex="0" class="prism-code language-diff codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"> exports.play = {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">     wrapper: &#x27;&lt;div style={{padding: 20}}&gt;{children}&lt;/div&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"> };</span></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">// 在初始化模块中</span></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"> export function Wrapper({children}) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">       return (</span></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">           &lt;div style={{padding: 20}}&gt;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">               {children}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">           &lt;/div&gt;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">       );</span></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"> }</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>而<code>injectResources</code>则可以转换为全局配置中单纯的<code>import</code>语句：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly diff"><pre tabindex="0" class="prism-code language-diff codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"> exports.play = {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">     injectResources: [</span></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">         path.join(__diranme, &#x27;src&#x27;, &#x27;styles&#x27;, &#x27;app.global.css&#x27;),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">     ],</span></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"> };</span></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">// 在初始化模块中</span></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"> import &#x27;@/styles/app.global.css&#x27;;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="api变更"></a>API变更<a class="hash-link" href="#api变更" title="Direct link to heading">#</a></h2><p>如果你除了使用命令行和配置文件外，还会主动<code>import</code>引用<code>@reskript/*</code>包并调用它们的内部API，那么以下是相关变更的摘要：</p><ul><li><code>@reskript/config-babel</code>包的相关函数中的<code>hot</code>配置从<code>&#x27;simple&#x27; | &#x27;all&#x27; | &#x27;none&#x27;</code>修改为<code>boolean</code>类型。</li><li><code>@reskript/config-babel</code>包的<code>defaultImportOptimization</code>参数已经废弃，改用<code>uses</code>参数。</li><li><code>@reskript/settings</code>中导出的函数均修改为异步接口，特别是<code>readProjectSettings</code>是你需要重点关心的。</li><li><code>@reskript/core</code>中的辅助函数均修改为异步接口。</li><li><code>@reskript/config-webpack</code>中的<code>createWebpackConfig</code>修改为异步函数，且参数有较大的调整。</li><li><code>@reskript/config-webpack</code>导出的<code>loaders</code>字典中的<code>svg</code>与<code>url</code>属性已经移除，没有替代品，V2版本使用<a href="https://webpack.js.org/guides/asset-modules/" target="_blank" rel="noopener noreferrer">Webpack Asset Modules</a>处理静态文件。</li><li><code>@reskript/config-dev-server</code>中的<code>createWebpackDevServerConfig</code>和<code>createWebpackDevServerPartial</code>修改为异步函数，且参数有较大的调整。</li><li>所有涉及到<code>BuildContext</code>这一类型（包括<code>RuntimeBuildContext</code>和<code>BuildEntry</code>）的逻辑，其中<code>cache</code>属性由<code>boolean</code>类型变更为<code>&#x27;persist&#x27; | &#x27;transient&#x27; | &#x27;off&#x27;</code>，原<code>cache: true</code>对应<code>cache: &#x27;persist&#x27;</code>。</li><li><code>est-compat</code>功能已经被移除，大概率你是不知道这个东西的。</li></ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/reskript/docs/plugins/workspace-no-build"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Monorepo源码依赖</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/reskript/docs/faq"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">FAQ »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#每一位都要了解的" class="table-of-contents__link">每一位都要了解的</a><ul><li><a href="#nodejs版本" class="table-of-contents__link">NodeJS版本</a></li><li><a href="#推荐固定版本" class="table-of-contents__link">推荐固定版本</a></li><li><a href="#安装core-js" class="table-of-contents__link">安装core-js</a></li><li><a href="#svg使用方式变化" class="table-of-contents__link">SVG使用方式变化</a></li></ul></li><li><a href="#命令行变更" class="table-of-contents__link">命令行变更</a><ul><li><a href="#build" class="table-of-contents__link">build</a></li><li><a href="#dev" class="table-of-contents__link">dev</a></li><li><a href="#babel" class="table-of-contents__link">babel</a></li><li><a href="#test" class="table-of-contents__link">test</a></li></ul></li><li><a href="#配置文件变更" class="table-of-contents__link">配置文件变更</a><ul><li><a href="#build相关" class="table-of-contents__link">build相关</a></li><li><a href="#devserver相关" class="table-of-contents__link">devServer相关</a></li><li><a href="#play相关" class="table-of-contents__link">play相关</a></li></ul></li><li><a href="#api变更" class="table-of-contents__link">API变更</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"></div></div></footer></div>
<script src="/reskript/assets/js/runtime~main.212b4bf1.js"></script>
<script src="/reskript/assets/js/main.a26f1fa1.js"></script>
</body>
</html>