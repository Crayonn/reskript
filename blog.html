<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<link rel="alternate" type="application/rss+xml" href="/reskript/blog/rss.xml" title="reSKRipt Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/reskript/blog/atom.xml" title="reSKRipt Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="reSKRipt" href="/reskript/opensearch.xml"><title data-react-helmet="true">Blog | reSKRipt</title><meta data-react-helmet="true" property="og:title" content="Blog | reSKRipt"><meta data-react-helmet="true" name="description" content="Blog"><meta data-react-helmet="true" property="og:description" content="Blog"><meta data-react-helmet="true" property="og:url" content="https://ecomfe.github.io/reskript/blog"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="blog_posts_list"><link data-react-helmet="true" rel="shortcut icon" href="/reskript/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://ecomfe.github.io/reskript/blog"><link data-react-helmet="true" rel="alternate" href="https://ecomfe.github.io/reskript/blog" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://ecomfe.github.io/reskript/blog" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/reskript/assets/css/styles.7a0f85c1.css">
<link rel="preload" href="/reskript/assets/js/runtime~main.9973ecc7.js" as="script">
<link rel="preload" href="/reskript/assets/js/main.57319ea8.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/reskript/"><img src="/reskript/images/logo.svg" alt="reSKRipt" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/reskript/images/logo.svg" alt="reSKRipt" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a><a class="navbar__item navbar__link" href="/reskript/docs/getting-started">文档</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/reskript/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/ecomfe/reskript" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-list-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_2ahu thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_2hhb margin-bottom--md">Recent posts</div><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/reskript/blog/play-with-router">用skr play调试需要路由的组件</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/reskript/blog/svg-import-change">导入SVG文件规则调整</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/reskript/blog/use-reflect-metadata">支持Reflect Metadata</a></li></ul></nav></aside><main class="col col--7"><article class="margin-bottom--xl"><header><h2 class="blogPostTitle_GeHD"><a href="/reskript/blog/play-with-router">用skr play调试需要路由的组件</a></h2><div class="blogPostData_291c margin-vert--md"><time datetime="2021-08-17T08:21:25.434Z">August 17, 2021</time> · One min read</div><div class="avatar margin-vert--md"><a href="https://github.com/otakustay" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://www.gravatar.com/avatar/d7479a703555cc76b277040e5be9b8ca" alt="otakustay"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://github.com/otakustay" target="_blank" rel="noopener noreferrer">otakustay</a></div><small class="avatar__subtitle"></small></div></div></header><div class="markdown"><p>在使用<code>reSKRipt</code>的时候，我们非常推荐使用<a href="https://ecomfe.github.io/reskript/docs/advanced/debug-component" target="_blank" rel="noopener noreferrer">skr play命令</a>来调试单个组件，它会为你提供一个可实时编程的界面，实时看到对应组件的可交互界面。</p><p>但并不是每一个组件都纯粹到可以没有外部依赖就跑起来的，其中很典型的一种情况就是<strong>组件依赖了路由</strong>，例如我们需要用<code>useParams()</code>来获取URL中的参数，或使用<code>useLocation()</code>拿到具体的路径信息。由于<code>skr play</code>默认的调试环节是不具备路由等环境的，因此需要我们做一些额外的配置工作。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="目录结构"></a>目录结构<a class="hash-link" href="#目录结构" title="Direct link to heading">#</a></h2><p>我们假定正在开发一个<code>Foo</code>组件，它需要使用<code>react-router-dom</code>才能正常展示，那么可以有下面这样的目录结构：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/src</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /components</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /Foo</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            /__repl__</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                index.play.js</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            index.tsx</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>其中<code>src/components/Foo/index.tsx</code>为组件的实现代码。我们可以看到这个结构中多了一个<code>src/components/Foo/__repl__/index.play.js</code>文件，这个被称为<code>skr play</code>的配置文件。这个文件的名字与组件文件名同名，如果你的组件文件名是<code>Bar.tsx</code>，那么它就是<code>__repl__/Bar.play.js</code>。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="注入外部依赖"></a>注入外部依赖<a class="hash-link" href="#注入外部依赖" title="Direct link to heading">#</a></h2><p>在<code>__repl__/index.play.js</code>中，我们可以编写以下内容：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token keyword module" style="font-style:italic">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token imports maybe-class-name">MemoryRouter</span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword module" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;react-router-dom&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword module" style="font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> provides </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token maybe-class-name">MemoryRouter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>可以看到，我们引用了<code>react-router-dom</code>中的<code>MemoryRouter</code>，并通过<code>export const provides</code>对象把它导了出去。</p><p>在配置文件中，<code>export const provides</code>导出可以将你需要的内容“带给”<code>skr play</code>的调试现场。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="使用依赖"></a>使用依赖<a class="hash-link" href="#使用依赖" title="Direct link to heading">#</a></h2><p>当你使用<code>skr play src/components/Foo/index.tsx</code>打开调试现场时，你看到的代码中依然没有<code>MemoryRouter</code>，此时你还是不能正确地看到组件的长相。你需要将左侧编辑器中的代码调整为这样：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jsx"><pre tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">Repl</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag class-name" style="color:rgb(255, 203, 107)">I.MemoryRouter</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">initialEntries</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token tag script language-javascript string" style="color:rgb(195, 232, 141)">&#x27;/foo/bar/123&#x27;</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag class-name" style="color:rgb(255, 203, 107)">Foo</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag class-name" style="color:rgb(255, 203, 107)">I.MemoryRouter</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>简单来说，所有你在配置文件的<code>provides</code>对象里提供的东西，都可以在界面中用<code>I.xxx</code>拿来用。</p><p>当然，为了调试方便，也可以把<code>Link</code>也提供出去，在调试界面里加几个链接来快速跳到某些URL下看效果。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="总结"></a>总结<a class="hash-link" href="#总结" title="Direct link to heading">#</a></h2><p>我们介绍了通过<code>__repl__/xxx.play.js</code>配置文件导出依赖给调试现场的方法，重点在于：</p><ol><li>有一个<code>__repl__/xxx.play.js</code>作为<code>skr play</code>的配置文件，与组件一一对应。</li><li>使用<code>export const provides</code>对象提供依赖。</li><li>在调试现场使用<code>I.xxx</code>使用依赖。</li></ol><p>除了路由，你也可以用相同的方法解决如<code>Context</code>等问题。</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><a class="margin-horiz--sm" href="/reskript/blog/tags/play">play</a><a class="margin-horiz--sm" href="/reskript/blog/tags/debug">debug</a><a class="margin-horiz--sm" href="/reskript/blog/tags/router">router</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="blogPostTitle_GeHD"><a href="/reskript/blog/svg-import-change">导入SVG文件规则调整</a></h2><div class="blogPostData_291c margin-vert--md"><time datetime="2021-08-17T08:21:25.434Z">August 17, 2021</time> · One min read</div><div class="avatar margin-vert--md"><a href="https://github.com/otakustay" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://www.gravatar.com/avatar/d7479a703555cc76b277040e5be9b8ca" alt="otakustay"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://github.com/otakustay" target="_blank" rel="noopener noreferrer">otakustay</a></div><small class="avatar__subtitle"></small></div></div></header><div class="markdown"><p>在之前版本的<code>reSKRipt</code>中，你可以通过<code>ReactComponent</code>这一命名导出中获得一个SVG转换出来的组件：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jsx"><pre tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">ReactComponent </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> IconClose</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;./close.svg&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag class-name" style="color:rgb(255, 203, 107)">IconClose</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>从<code>reSKRipt v1.13.0</code>开始，这个规则将发生一些改变。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="背景"></a>背景<a class="hash-link" href="#背景" title="Direct link to heading">#</a></h2><p>在Webpack的发展历史上，<a href="https://github.com/webpack-contrib/url-loader" target="_blank" rel="noopener noreferrer">url-loader</a>是负责将一个资源转为一个引用它的URL的准官方工具。但随着<a href="https://webpack.js.org/guides/asset-modules/" target="_blank" rel="noopener noreferrer">新版本的Webpack支持asset module</a>，<code>url-loader</code>已经被官方标记为废弃了。</p><p>基于这一个技术的发展，原有的<a href="https://github.com/ecomfe/svg-mixed-loader" target="_blank" rel="noopener noreferrer">svg-mixed-loader</a>也不再能独立地发展。我在<a href="https://github.com/webpack/webpack/issues/13870" target="_blank" rel="noopener noreferrer">这个issue</a>中和Webpack官方进行了一系列的探讨，最终官方的意见是比较直白的：</p><blockquote><p>不要让loader去做这么复杂的事，应该在规则上区分它们，并用资源查询来处理。</p></blockquote><p>基于官方给出的意见，<code>reSKRipt</code>也计划做出相应的调整。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="调整后的使用方式"></a>调整后的使用方式<a class="hash-link" href="#调整后的使用方式" title="Direct link to heading">#</a></h2><p>如果你需要一个SVG为你提供URL字符串，则与原有保持一样。：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token keyword module" style="font-style:italic">import</span><span class="token plain"> </span><span class="token imports">url</span><span class="token plain"> </span><span class="token keyword module" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;./close.svg&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>如果你希望获得一个组件，需要调整代码：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token keyword module" style="font-style:italic">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">IconClose</span><span class="token plain"> </span><span class="token keyword module" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;./close.svg?react&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>注意在最后增加了一个<code>?react</code>的查询。</p><p>如果你两者都要，那么你需要写2条<code>import</code>语句。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="在css中使用"></a>在CSS中使用<a class="hash-link" href="#在css中使用" title="Direct link to heading">#</a></h3><p>在之前的版本中，如果你在CSS中引入一个SVG文件，它大概率是不能工作的：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly css"><pre tabindex="0" class="prism-code language-css codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token selector class" style="color:rgb(199, 146, 234)">.root</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">background-image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token url function" style="color:rgb(130, 170, 255)">url</span><span class="token url punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token url string url" style="color:rgb(221, 221, 221)">&quot;./background.svg&quot;</span><span class="token url punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>因为SVG被处理成了一个具备URL和组件代码的混合内容。为了保持向后兼容性，我们现在无法修改这个行为，但增加了一个方式让CSS可以直接引用图片：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly css"><pre tabindex="0" class="prism-code language-css codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token selector class" style="color:rgb(199, 146, 234)">.root</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">background-image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token url function" style="color:rgb(130, 170, 255)">url</span><span class="token url punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token url string url" style="color:rgb(221, 221, 221)">&quot;./background.svg?asset&quot;</span><span class="token url punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>你需要在资源上增加一个<code>?asset</code>的查询，即告知<code>reSKRipt</code>你只需要它被转化为一个URL。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="废弃警告"></a>废弃警告<a class="hash-link" href="#废弃警告" title="Direct link to heading">#</a></h3><p>如果你现在依然使用原来的<code>ReactComponent</code>导出，你的代码将正常工作，但在浏览器的控制台中将看到一条类似的警告：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">import {ReactComponent} from &#x27;*.svg&#x27; is deprecated, please use import ReactComponent from &#x27;*.svg?react&#x27; instead.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">This warning emits because you imported {ReactComponent} from /path/to/filename.svg</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>这条警告仅在<code>development</code>模式下出现，你可以快速定位到相关的代码并进行修改。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="关于类型"></a>关于类型<a class="hash-link" href="#关于类型" title="Direct link to heading">#</a></h2><p>当然，现在的方式使得<code>.svg</code>文件随着查询的不同会呈现出不同的类型，因此我们的TypeScript定义也要相应调整：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ts"><pre tabindex="0" class="prism-code language-ts codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">module</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;*.svg&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> url</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">default</span><span class="token plain"> url</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">module</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;*.svg?react&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token imports maybe-class-name">ComponentType</span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token imports"> </span><span class="token imports maybe-class-name">SVGAttributes</span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;react&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token maybe-class-name">Component</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token maybe-class-name">ComponentType</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token maybe-class-name">SVGAttributes</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token maybe-class-name">SVGElement</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">default</span><span class="token plain"> </span><span class="token maybe-class-name">Component</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>以上代码我们建议放到<code>src/types/static.d.ts</code>中。</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><a class="margin-horiz--sm" href="/reskript/blog/tags/build">build</a><a class="margin-horiz--sm" href="/reskript/blog/tags/svg">svg</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="blogPostTitle_GeHD"><a href="/reskript/blog/use-reflect-metadata">支持Reflect Metadata</a></h2><div class="blogPostData_291c margin-vert--md"><time datetime="2021-08-17T08:21:25.434Z">August 17, 2021</time> · One min read</div><div class="avatar margin-vert--md"><a href="https://github.com/otakustay" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://www.gravatar.com/avatar/d7479a703555cc76b277040e5be9b8ca" alt="otakustay"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://github.com/otakustay" target="_blank" rel="noopener noreferrer">otakustay</a></div><small class="avatar__subtitle"></small></div></div></header><div class="markdown"><p><code>reSKRipt</code>从<code>v1.13.0</code>起，增加了对<code>Reflect.metadata</code>的支持，对应TyepScript中的<a href="https://www.typescriptlang.org/tsconfig#emitDecoratorMetadata" target="_blank" rel="noopener noreferrer">emitDecoratorMetadata</a>配置项。</p><p>考虑到这一功能会生成额外的代码，而大部分应用并不需要，我们将它隐藏在了<code>build.uses</code>配置项中，具体可参考<a href="https://ecomfe.github.io/reskript/docs/settings/build#%E7%89%B9%E6%AE%8A%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E7%9A%84%E4%BC%98%E5%8C%96" target="_blank" rel="noopener noreferrer">特殊第三方库的优化</a>章节的说明。</p><p>如果你从现在开始希望使用这一功能，可以将你的<code>reskript.config.js</code>修改为以下内容：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">exports</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">build</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    uses</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;antd&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;lodash&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;reflect-metadata&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>需要注意的是，如果你原本没有<code>build.uses</code>配置，那么自定义该配置会导致默认值（<code>[antd&#x27;, &#x27;lodash&#x27;]</code>）失效，因此需要自己重新补充上这2个值。</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><a class="margin-horiz--sm" href="/reskript/blog/tags/build">build</a><a class="margin-horiz--sm" href="/reskript/blog/tags/babel">babel</a></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></main></div></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"></div></div></footer></div>
<script src="/reskript/assets/js/runtime~main.9973ecc7.js"></script>
<script src="/reskript/assets/js/main.57319ea8.js"></script>
</body>
</html>